## 비디오 가게 애플리케이션(TDD)

대략적 업무 시나리오:
고객에게 비디오 타이틀을 대여하고 대여한 타이틀에 대한 요금을 알려준다. 비디오 가게에서는 포인트 제도를 운영중이며, 영화 종류와 대여기간에 따라 포인트가 조금 다르다. 

목적
- 비디오 가게에서 고객이 대여하는 비디오의 대여정보를 조회하는 프로그램을 작성한다.

요구사항
- 고객은 이름을 갖는다.
- 고객은 한 번에 여러 개의 비디오를 대여할 수 있으나 각각의 대여기간은 다를 수 있다.
- 비디오는 영화, 스포츠, 다큐멘터리의 세 종류가 있다.
- 각 비디오는 독립적인 일일 대여요금을 갖는다.
- 영화는 대여기간이 2일 이상 되면 3일째부터는 대여요금이 1/2로 할인된다.
- 다큐멘터리는 3일 이상 대여하면 4일째부터는 1/3로 할인된다.
- 스포츠는 장기대여 할인이 없다.
- 비디오 1개 대여할 때마다 보너스 포인트는 1포인트씩 올라간다. 단, 스포츠는 2포인트씩 올라간다.
- 과거의 대여기록을 보유하고 있을 필요는 없으나, 고객이 얻은 총 보너스 포인트 정보는 알고 있어야 한다.
- 고객의 현재 대여정보를 구할 수 있는 기능을 작성하라.

>총 대여비디오수
>
>대여정보: 비디오(종류+제목+가격), 대여기간 리스트
>
>총 대여 가격
>
>현재 대여하고 있는 비디오로 인해 추가된 포인트

요구사항을 디테일적으로 정련함.

고객은 한 번에 여러 개의 비디오를 대여할 수 있으나 각 대여기간은 다를 수 있다.

*업무 규칙*
- 고객은 한 번에 여러 개의 비디오를 대여할 수 있다.
- 대여기간은 비디오마다 각각 다를 수 있다.

비디오는 영화, 스포츠, 다큐멘터리의 세 종류가 있다.

*업무 규칙*
- 비디오에는 종류가 있다.
- 현재 비디오의 종류는 영화, 스포츠, 다큐멘터리의 세 종류다.

위와 같이 요구사항을 상세화해서 다시 적으면 아래와 같다.

### 업무 규칙

1. 고객은 이름을 갖는다.
2. 고객은 한 번에 여러 개의 비디오를 대여할 수 있다.
3. 대여기간은 비디오마다 각각 다를 수 있다.
4. 비디오에는 종류가 있다.
5. 현재 비디오의 종류는 영화, 스포츠, 다큐멘터리의 세 종류다.
6. 각 비디오는 독립적인 일일 대여요금을 갖는다.
7. 영화는 대여기간이 2일 이상 되면 3일째부터는 대여요금이 1/2로 할인된다.
   - 예: 영화는 대여기간이 n일 이상이 되면 m일째부터는 대여요금이 p로 할인된다.
8. 다큐멘터리는 3일 이상 대여하면 4일째부터는 1/3로 할인된다.
   - 예: 어떤 비디오의 타입은 n일 이상 대여하면 m일째부터는 p로 할인된다.
9. 스포츠는 장기대여 할인이 없다.
   - 예: 어떤 비디오 타입은 장기대여 할인이 없다.
10. 비디오 1개 대여할 때마다 보너스 포인트는 1포인트씩 누적된다(단, 스포츠는 2포인트씩).
   - 예: 고객의 보너스 포인트 누적점수는 비디오를 n개 대여할 때마다 보너스 포인트는 m포인트씩 누적된다(단, 특정 타입은 p포인트씩). 
11. 시스템은 고객의 과거 대여기록을 보유할 필요가 없다.

#### 고객과 협의해 확정해야 하는 업무 규칙

- 대여는 일 단위다.
- 포인트는 정수다.
- 할인은 분수 비율이다.

#### 기능 요구사항

1. 고객은 비디오를 대여할 수 있다.
2. 시스템은 고객의 현재 대여정보를 제공할 수 있다.
   - 대여정보
     - 총 대여비디오 수
     - 비디오(종류+제목+가격), 대여기간 리스트
     - 총 대여가격
     - 현재 대여하고 있는 비디오로 인해 추가된 포인트
3. 시스템은 현 대여로 인해 발생하는 포인트 총합을 계산할 수 있다.
4. 시스템은 대여된 비디오들의 총 대여가격을 계산할 수 있다.
5. 시스템은 총 대여비디오 수를 계산할 수 있다.

#### 기타 요구사항 확인 작업

- 과거의 대여기록을 보유하고 있을 필요는 없으나 고객이 얻은 총 보너스 포인트 정보는 알아야 한다. -> 포인트 정보의 기록을 의미하는 건지, 개별 포인트만의 관리가 아닌 대여 반납의 포인트 합산인지 확인한다.

#### 행위 기반 클래스 도출

>대여한다 (고객이 비디오를)
>
>할인된다 (비디오 일일 대여가격이) -> 할인한다 (시스템이 비디오 일일 대여가격을)
>
>누적된다 (보너스 포인트가) -> 누적한다 (시스템이 포인트를)
>
>계산한다 (시스템이 포인트 총합을)

>계산한다 (시스템이 총 대여가격을)
>
>계산한다 (시스템이 총 대여비디오 수를)
>
>제공한다 (시스템이 대여정보를)

#### 소유 기반 클래스 도출

>이름을 갖는다 (각 고객은)
>
>종류를 갖는다 (각 비디오는)
>
>대여요금을 갖는다 (각 비디오는)
>
>포인트를 갖는다 (각 비디오는)

>대여일수를 갖는다 (비디오가? 고객이?) -> 대여일수를 갖는다 (각 대여는)

위의 모든 내용을 정리하여 클래스로 도출하면 아래와 같다.

고객(Customer) 
- 대여한다(비디오를)

대여(Rental)
- 속성: 대여 일수

비디오(Video)
- 속성: 종류(비디오 타입)
- 속성: 대여 요금

비디오 타입(VideoType)
- 속성: 포인트

고객과 대여는 1:N이고 대여와 비디오는 1:1 비디오와 비디오 타입은 1:1 이다.

추가로 비디오의 모든 시스템을 관리할 비디오샵이 있다.

비디오샵
- 계산한다 (포인트 총합)
- 할인한다 (일일 대여가격을)
- 누적한다 (포인트를)
- 계산한다 (포인트 총합을)
- 계산한다 (총 대여가격을)
- 계산한다 (총 대여비디오 수를)
- 제공한다 (대여정보를)

비디오샵과 고객은 1:N이다.

TDD를 할 때 중요한 주안점은 소유 기반 클래스부터 시작해서 점진적으로 행위 기반 클래스까지 차분히 
테스트 케이스를 만들면서 개발해나가는 것이다. 그렇게 하면 최종적으로는 통합 테스트 수준의 테스트 케이스가 자연스럽게 만들어진다.

